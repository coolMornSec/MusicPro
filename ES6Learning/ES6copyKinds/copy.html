<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
	</head>
	<body>
		<h2>浅谈拷贝的几种方式</h2>
		<script src="../jquery-3.4.1.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			// jQuery.extend(), 用于将多个对象的内容合并到目标对象
			// 如果多个对象合并, 同名属性后面的对象会覆盖前面的
			// 1、Array 拷贝
			const arr = [{
					0: true,
					a: 123,
					b: 456
				},
				{
					a: 111,
					b: 222,
					cc: function() {
						console.log('看看我');
					}
				},
			];
		
			// 方法一
			// let arr2 = $.extend([],arr);		// 浅层拷贝, 如果元素有对象,拷贝的是引用值，修改属性值会有影响
			// arr2[0].a = 456;
			// console.log('原数组', arr);
			// console.log('jqeury浅层拷贝数组', arr2);

			// 方法二
			// let arr3 = $.extend(true,[],arr);			// 深层拷贝, 修改属性值不会造成影响
			// arr3[0].a = '###';
			// console.log('原数组', arr);
			// console.log('深层克隆数组', arr3);		// 修改数组中某对象的属性后, 原数组对象属性不受影响

			// 方法三
			// let arr4 = [...arr];					// 扩展运算符（spread）浅层拷贝
			// arr4[0].a = '@@@';
			// console.log('原数组', arr);
			// console.log('ES6扩展运算符浅层拷贝数组', arr4);



			// 方法四
			// ES6对象方法	浅层拷贝
			// Object.assign(target, source_1, ···)
			// 用于将源对象的所有可枚举属性复制到目标对象中, 如果目标对象和源对象有同名属性，
			// 或者多个源对象有同名属性，则后面的属性会覆盖前面的属性。

			// 方法五
			// let arrCopy = JSON.parse( JSON.stringify(arr) );
			// arrCopy[0].a = '!!!';
			// console.log('原数组', arr);
			// console.log('序列化反序列化深层克隆', arrCopy);
			// 此处需要注意的是：作为Oject的深度拷贝时，要复制的function会直接消失，所以此方法只能用在只有单纯数据的对象（工作中接口返回数据通常是不会有函数的）。

			// 封装深度克隆函数
			function deepClone(obj) {

				let newObj = obj instanceof Array ? [] : {};

				for (let i in obj) {

					newObj[i] = typeof obj[i] == 'object' ? deepClone(obj[i]) : obj[i];

				}

				return newObj;

			}
			
			let newArr = deepClone(arr);
			newArr[0].a = "XXX"
			console.log(arr);

			// 2、对象拷贝
			// let obj = {
			// 	name: 'lingchen',
			// 	age: '18',
			// 	lovers: {
			// 		one: 'snow',
			// 		two: 'bell',
			// 		three: 'cloud'
			// 	},
			// 	hobby: 'eat'
			// }
			// let obj2 = {
			// 	name: 'lingchen',
			// 	age: '20',
			// 	lovers: {
			// 		one: 'rain',
			// 		two: 'bell',
			// 		three: 'cloud'
			// 	},
			// 	loveSong: '追梦赤子心'
			// }
			// 拷贝
			// let temp = $.extend(false, {}, obj);			// 浅层拷贝
			// let temp = $.extend(true, {}, obj);			// 深层拷贝
			// let temp = {...obj};							// 浅层拷贝
			// let temp = {
			// 	...obj,
			// 	lovers: {
			// 		...obj.lovers
			// 	}
			// };											// 深层拷贝

			// temp.lovers.one = 'rain';
			// console.log(temp, obj);

			// 合并
			// $.extend(obj, obj2);					// 合并
			// $.extend(true, obj, obj2);			// 合并

			// obj.lovers.one = 'frost';
			// console.log(obj, obj2);

			// 个别属性值替换
			// obj = {
			// 	...obj,
			// 	age: 100
			// }
			// console.log(obj);
		</script>
	</body>
</html>
